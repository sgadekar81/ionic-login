!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@angular/common"),require("@ionic-native/facebook"),require("@ionic-native/google-plus"),require("angularx-restful/srv/rest.service"),require("angularx-restful/classes/rest-params"),require("ionic-modal-helper/ionic-modal-helper.service"),require("ionic-angular"),require("@ionic-native/native-storage"),require("angularx-restful")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","@ionic-native/facebook","@ionic-native/google-plus","angularx-restful/srv/rest.service","angularx-restful/classes/rest-params","ionic-modal-helper/ionic-modal-helper.service","ionic-angular","@ionic-native/native-storage","angularx-restful"],r):r((e.ng=e.ng||{},e.ng["ionic-login"]=e.ng["ionic-login"]||{}),e.ng.core,e._angular_common,e._ionicNative_facebook,e._ionicNative_googlePlus,e.angularxRestful_srv_rest_service,e.angularxRestful_classes_restParams,e.ionicModalHelper_ionicModalHelper_service,e.ionicAngular,e._ionicNative_nativeStorage,e.angularxRestful)}(this,function(e,r,t,i,o,n,s,a,c,l,u){"use strict";var p=function(){function e(){}return e.API_ENDPT="https://life-skills-dev.appspot.com",e}(),f=function(){function e(){}return e.getFbProfile="https://graph.facebook.com/v2.8/me?fields=first_name,last_name,gender,picture.width(500).height(500),birthday,email&access_token=",e.genJustbeAccessToken=p.API_ENDPT+"/api/justbe/generateJusteBeToken",e}(),h=function(){return function(e,r,t,i,o,n){this.images=new Array,this.emails=new Array,e&&(this.firstName=e),r&&(this.lastName=r),t&&this.images.push(t),i&&this.emails.push(i),o&&(this.id=o),n&&(this.gender=n)}}(),g=function(){function e(){}return e.prototype.getStabilizedProfile=function(e,r){switch(e.loginType){case"facebook":return new h(r.first_name,r.last_name,this.getFbProfileImg(r),r.email,r.id,r.gender);case"google":return new h(r.givenName,r.familyName,r.imageUrl,r.email,r.userId,r.gender)}},e.prototype.getFbProfileImg=function(e){return e.picture&&e.picture.data&&e.picture.data.url?e.picture.data.url:console.log("no image found for fb profile//missing from facebook only")},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[]},e}(),m=function(){function e(e,r,t,i){this._rst=e,this._fb=r,this._ggp=t,this._profileStabilizer=i}return e.prototype.execute=function(e,r,t){switch(this.setLcircular(e,r,t),e.loginType){case"facebook":return this.fbLogin();case"google":return this.ggpLogin()}},e.prototype.get_fbProfile=function(e){var r=this;this.lCircular.params=new s.RestParams,this.lCircular.params.uri=f.getFbProfile+e.authResponse.accessToken,this.getProfile(this.lCircular.params).subscribe(function(e){r.stabilizeProfile(e)})},e.prototype.getProfile=function(e){return this._rst.get(e).map(function(e){return JSON.parse(e._body)},function(e){return e})},e.prototype.setLcircular=function(e,r,t){this.lCircular=new Object,this.lCircular.success=r,this.lCircular.error=t,this.lCircular._circular=e},e.prototype.stabilizeProfile=function(e){var r=this._profileStabilizer.getStabilizedProfile(this.lCircular._circular,e);this.emitOutput(r)},e.prototype.emitOutput=function(e){this.lCircular.success(e)},e.prototype.fbLogin=function(){var e=this;this._fb.login(["public_profile","email"]).then(function(r){e.get_fbProfile(r)},function(r){e.lCircular._circular.error(r)})},e.prototype.ggpLogin=function(){var e=this;this._ggp.login({}).then(function(r){e.stabilizeProfile(r)},function(r){e.lCircular._circular.error(r)})},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:n.RestService},{type:i.Facebook},{type:o.GooglePlus},{type:g}]},e}(),d=function(){return function(e,r){e&&(this.imageUrl=e),this.defaultImage=!!r}}(),b=function(){return function(e,r,t,i,o,n,s){e&&(this.userVerified=e),r&&(this.firstName=r),t&&(this.lastName=t),i&&(this.emails=i),o&&o[0]&&(this._images=new Array,this._images.push(new d(o[0],!0))),n&&(this.dob=n),"male"===s?this.gender=0:"female"===s&&(this.gender=1)}}(),y=function(){function e(e,r){var t=this.getVals(e);this.profileType=t.profileType,this.openProfileId=t.openProfileId,this.profileVO=new b(!1,e.profile.firstName,e.profile.lastName,e.profile.emails,e.profile.images,e.profile.dob,e.profile.gender)}return e.prototype.getVals=function(e){switch(e.loginType){case"facebook":return{profileType:"FacebookProfile",openProfileId:"FacebookProfile#"+e.profile.id};case"google":return{profileType:"Google2Profile",openProfileId:"Google2Profile#"+e.profile.id};default:return{profileType:"",openProfileId:""}}},e}(),_=function(){function e(e,r){this._navParams=e,this._ionicModalHelperSrv=r,console.log(e.data.afterSelectEmail)}return e.prototype.onSubmitClick=function(e){this.basicValidateEmail(e)?this._navParams.data&&this._navParams.data.afterSelectEmail?(this._navParams.data.afterSelectEmail(e),this._ionicModalHelperSrv.closeModal()):console.error("pass callback function to component, what to do after clicking on submit"):this.validationMsg="Invalid Email"},e.prototype.basicValidateEmail=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},e.decorators=[{type:r.Component,args:[{selector:"email-getter",templateUrl:"email-getter.html"}]}],e.ctorParameters=function(){return[{type:c.NavParams},{type:a.IonicModalHelperSrv}]},e}(),v=function(){function e(e,r){this._rst=e,this._ionicModalHelperSrv=r}return e.prototype.execute=function(e,r,t){var i=this;this.setLcircular(e,r,t),this.lCircular.justbeProfile=new y(e,this.lCircular),this.validation(this.lCircular.justbeProfile)?this.getJustbeAccessToken(this.lCircular.params).subscribe(function(e){i.lCircular.success(e)}):this._ionicModalHelperSrv.raiseModal(_,{afterSelectEmail:this.afterEmailSelect.bind(this)})},e.prototype.setLcircular=function(e,r,t){this.lCircular=new Array,this.lCircular.success=r,this.lCircular.error=t,this.lCircular._circular=e,this.lCircular.params=new s.RestParams,this.lCircular.params.uri=f.genJustbeAccessToken},e.prototype.getJustbeAccessToken=function(e){var r=this;return e.payload=this.lCircular.justbeProfile,this._rst.post(e).map(function(e){return JSON.parse(e._body)},function(e){r.lCircular._circular.error(e)})},e.prototype.validation=function(e){return e.profileVO.emails.length>0},e.prototype.afterEmailSelect=function(e){var r=this;this.lCircular.params.payload.justbeProfile.profileVO.emails.push(e),this.getJustbeAccessToken(this.lCircular.params).subscribe(function(e){r.lCircular.success(e)})},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:n.RestService},{type:a.IonicModalHelperSrv}]},e}(),P=function(){function e(e,r,t){this._ssp=e,this._ysp=r,this._nativeStorage=t,this.onInit()}return e.prototype.onInit=function(){},e.prototype.login=function(e,r,t){this.setCircular(e,r,t),this._ssp.execute(this.circular,this.onSspSuccess.bind(this),this.onSspError.bind(this))},e.prototype.onSspSuccess=function(e){this.circular.profile=e,console.log("new code comming in"),console.log(e),this._ysp.execute(this.circular,this.onYspSuccess.bind(this),this.onYspError.bind(this))},e.prototype.onSspError=function(e){this.circular.error(e)},e.prototype.onYspSuccess=function(e){this.circular.success(e),this._nativeStorage.setItem("access_token",e).then(function(){return console.log("Stored item!")},function(e){return console.error("Error storing item",e)})},e.prototype.onYspError=function(e){this.circular.error(e)},e.prototype.setCircular=function(e,r,t){this.circular=new Object,this.circular.loginType=e,this.circular.success=r,this.circular.error=t},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:m},{type:v},{type:l.NativeStorage}]},e}(),S=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{declarations:[_],imports:[c.IonicModule],exports:[_]}]}],e.ctorParameters=function(){return[]},e}(),C=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{imports:[t.CommonModule,u.AngularxRestful,S],providers:[P,i.Facebook,o.GooglePlus,n.RestService,m,v,g,l.NativeStorage]}]}],e.ctorParameters=function(){return[]},e}();e.IonicLogin=C,Object.defineProperty(e,"__esModule",{value:!0})});