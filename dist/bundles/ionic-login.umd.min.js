!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@ionic-native/facebook"),require("@ionic-native/google-plus"),require("angularx-restful/srv/rest.service"),require("angularx-restful/classes/rest-params"),require("ionic-modal-helper/ionic-modal-helper.service"),require("ionic-angular"),require("@ionic-native/native-storage"),require("angularx-restful")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","@ionic-native/facebook","@ionic-native/google-plus","angularx-restful/srv/rest.service","angularx-restful/classes/rest-params","ionic-modal-helper/ionic-modal-helper.service","ionic-angular","@ionic-native/native-storage","angularx-restful"],t):t((e.ng=e.ng||{},e.ng["ionic-login"]=e.ng["ionic-login"]||{}),e.ng.core,e._angular_common,e._ionicNative_facebook,e._ionicNative_googlePlus,e.angularxRestful_srv_rest_service,e.angularxRestful_classes_restParams,e.ionicModalHelper_ionicModalHelper_service,e.ionicAngular,e._ionicNative_nativeStorage,e.angularxRestful)}(this,function(e,t,i,r,o,n,s,a,l,c,u){"use strict";var p=function(){function e(){}return e.API_ENDPT="https://life-skills-dev.appspot.com",e}(),f=function(){function e(){}return e.getFbProfile="https://graph.facebook.com/v2.8/me?fields=first_name,last_name,gender,picture.width(500).height(500),birthday,email&access_token=",e.genJustbeAccessToken=p.API_ENDPT+"/api/justbe/generateJusteBeToken",e}(),h=function(){return function(e,t,i,r,o,n){this.images=new Array,this.emails=new Array,e&&(this.firstName=e),t&&(this.lastName=t),i&&this.images.push(i),r&&this.emails.push(r),o&&(this.id=o),n&&(this.gender=n)}}(),g=function(){function e(){}return e.prototype.getStabilizedProfile=function(e,t){switch(e.loginType){case"facebook":return new h(t.first_name,t.last_name,this.getFbProfileImg(t),t.email,t.id,t.gender);case"google":return new h(t.givenName,t.familyName,t.imageUrl,t.email,t.userId,t.gender)}},e.prototype.getFbProfileImg=function(e){return e.picture&&e.picture.data&&e.picture.data.url?e.picture.data.url:console.log("no image found for fb profile//missing from facebook only")},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[]},e}(),m=function(){function e(e,t,i,r){this._rst=e,this._fb=t,this._ggp=i,this._profileStabilizer=r}return e.prototype.execute=function(e,t,i){switch(this.setLcircular(e,t,i),e.loginType){case"facebook":return this.fbLogin();case"google":return this.ggpLogin()}},e.prototype.get_fbProfile=function(e){var t=this;this.lCircular.params=new s.RestParams,this.lCircular.params.uri=f.getFbProfile+e.authResponse.accessToken,this.getProfile(this.lCircular.params).subscribe(function(e){t.stabilizeProfile(e)})},e.prototype.getProfile=function(e){return this._rst.get(e).map(function(e){return JSON.parse(e._body)},function(e){return e})},e.prototype.setLcircular=function(e,t,i){this.lCircular=new Object,this.lCircular.success=t,this.lCircular.error=i,this.lCircular._circular=e},e.prototype.stabilizeProfile=function(e){var t=this._profileStabilizer.getStabilizedProfile(this.lCircular._circular,e);this.emitOutput(t)},e.prototype.emitOutput=function(e){this.lCircular.success(e)},e.prototype.fbLogin=function(){var e=this;this._fb.login(["public_profile","email"]).then(function(t){e.get_fbProfile(t)},function(t){e.lCircular._circular.error(t)})},e.prototype.ggpLogin=function(){var e=this;this._ggp.login({}).then(function(t){e.stabilizeProfile(t)},function(t){e.lCircular._circular.error(t)})},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:n.RestService},{type:r.Facebook},{type:o.GooglePlus},{type:g}]},e}(),d=function(){return function(e,t){e&&(this.imageUrl=e),this.defaultImage=!!t}}(),b=function(){return function(e,t,i,r,o,n,s){e&&(this.userVerified=e),t&&(this.firstName=t),i&&(this.lastName=i),r&&(this.emails=r),o&&o[0]&&(this._images=new Array,this._images.push(new d(o[0],!0))),n&&(this.dob=n),"male"===s?this.gender=0:"female"===s&&(this.gender=1)}}(),y=function(){function e(e,t){var i=this.getVals(e);this.profileType=i.profileType,this.openProfileId=i.openProfileId,this.profileVO=new b(!1,e.profile.firstName,e.profile.lastName,e.profile.emails,e.profile.images,e.profile.dob,e.profile.gender)}return e.prototype.getVals=function(e){switch(e.loginType){case"facebook":return{profileType:"FacebookProfile",openProfileId:"FacebookProfile#"+e.profile.id};case"google":return{profileType:"Google2Profile",openProfileId:"Google2Profile#"+e.profile.id};default:return{profileType:"",openProfileId:""}}},e}(),_=function(){function e(e,t){this._navParams=e,this._ionicModalHelperSrv=t,console.log(e.data.afterSelectEmail),console.log(e.data.profile),this.profile=e.data.profile}return e.prototype.onSubmitClick=function(e){this.basicValidateEmail(e)?this._navParams.data&&this._navParams.data.afterSelectEmail?(this._navParams.data.afterSelectEmail(e),this._ionicModalHelperSrv.closeModal()):console.error("pass callback function to component, what to do after clicking on submit"):this.validationMsg="Invalid Email"},e.prototype.basicValidateEmail=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},e.decorators=[{type:t.Component,args:[{selector:"email-getter",template:'\n                <ion-header>\n  \n                </ion-header>\n                <ion-content padding>\n  \n                  <div style="text-align: center;">\n                    <img [src]="profile.profileVO._images[0].imageUrl"  style="width: 150px;">\n                    <h1>{{profile.profileVO.firstName}} {{profile.profileVO.lastName}}</h1>\n                  </div>\n                  <ion-list>\n                    <ion-item>\n                      <ion-input type="text" placeholder="Email" [(ngModel)]="email"></ion-input>\n                    </ion-item>\n                    <span style="color:red">{{validationMsg}}</span>\n\n                  </ion-list>\n              <button ion-button (click)="onSubmitClick(email)">Submit</button>\n              </ion-content>\n  '}]}],e.ctorParameters=function(){return[{type:l.NavParams},{type:a.IonicModalHelperSrv}]},e}(),v=function(){function e(e,t){this._rst=e,this._ionicModalHelperSrv=t}return e.prototype.execute=function(e,t,i){var r=this;this.setLcircular(e,t,i),this.lCircular.justbeProfile=new y(e,this.lCircular),this.validation(this.lCircular.justbeProfile)?this.getJustbeAccessToken(this.lCircular.params).subscribe(function(e){r.lCircular.success(e)}):this._ionicModalHelperSrv.raiseModal(_,{afterSelectEmail:this.afterEmailSelect.bind(this),profile:this.lCircular.justbeProfile})},e.prototype.setLcircular=function(e,t,i){this.lCircular=new Array,this.lCircular.success=t,this.lCircular.error=i,this.lCircular._circular=e,this.lCircular.params=new s.RestParams,this.lCircular.params.uri=f.genJustbeAccessToken},e.prototype.getJustbeAccessToken=function(e){var t=this;return e.payload=this.lCircular.justbeProfile,this._rst.post(e).map(function(e){return JSON.parse(e._body)},function(e){t.lCircular._circular.error(e)})},e.prototype.validation=function(e){return e.profileVO.emails.length>0},e.prototype.afterEmailSelect=function(e){var t=this;this.lCircular.params.payload=this.lCircular.justbeProfile,this.lCircular.params.payload.profileVO.emails.push(e),this.getJustbeAccessToken(this.lCircular.params).subscribe(function(e){t.lCircular.success(e)})},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:n.RestService},{type:a.IonicModalHelperSrv}]},e}(),P=function(){function e(e,t,i){this._ssp=e,this._ysp=t,this._nativeStorage=i,this.onInit()}return e.prototype.onInit=function(){},e.prototype.login=function(e,t,i){this.setCircular(e,t,i),this._ssp.execute(this.circular,this.onSspSuccess.bind(this),this.onSspError.bind(this))},e.prototype.onSspSuccess=function(e){this.circular.profile=e,console.log("new code comming in"),console.log(e),this._ysp.execute(this.circular,this.onYspSuccess.bind(this),this.onYspError.bind(this))},e.prototype.onSspError=function(e){this.circular.error(e)},e.prototype.onYspSuccess=function(e){this.circular.success(e),this._nativeStorage.setItem("access_token",e).then(function(){return console.log("Stored item!")},function(e){return console.error("Error storing item",e)})},e.prototype.onYspError=function(e){this.circular.error(e)},e.prototype.setCircular=function(e,t,i){this.circular=new Object,this.circular.loginType=e,this.circular.success=t,this.circular.error=i},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:m},{type:v},{type:c.NativeStorage}]},e}(),C=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[_],imports:[l.IonicModule],exports:[_],entryComponents:[_]}]}],e.ctorParameters=function(){return[]},e}(),S=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[i.CommonModule,u.AngularxRestful,C],providers:[P,r.Facebook,o.GooglePlus,n.RestService,m,v,g,c.NativeStorage]}]}],e.ctorParameters=function(){return[]},e}();e.IonicLogin=S,e.EmailGetterComponent=_,Object.defineProperty(e,"__esModule",{value:!0})});