!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("@angular/core"),require("@angular/common"),require("@ionic-native/facebook"),require("@ionic-native/google-plus"),require("angularx-restful/srv/rest.service"),require("angularx-restful/classes/rest-params"),require("ionic-modal-helper/ionic-modal-helper.service"),require("ionic-angular"),require("@ionic-native/native-storage"),require("ionic-toast-helper/ionic-toast-helper.service"),require("ionic-toast-helper/toast"),require("angularx-restful")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","@ionic-native/facebook","@ionic-native/google-plus","angularx-restful/srv/rest.service","angularx-restful/classes/rest-params","ionic-modal-helper/ionic-modal-helper.service","ionic-angular","@ionic-native/native-storage","ionic-toast-helper/ionic-toast-helper.service","ionic-toast-helper/toast","angularx-restful"],i):i((e.ng=e.ng||{},e.ng["ionic-login"]=e.ng["ionic-login"]||{}),e.ng.core,e._angular_common,e._ionicNative_facebook,e._ionicNative_googlePlus,e.angularxRestful_srv_rest_service,e.angularxRestful_classes_restParams,e.ionicModalHelper_ionicModalHelper_service,e.ionicAngular,e._ionicNative_nativeStorage,e.ionicToastHelper_ionicToastHelper_service,e.ionicToastHelper_toast,e.angularxRestful)}(this,function(e,i,t,r,o,n,s,a,l,c,u,p,f){"use strict";var h=function(){function e(){}return e.API_ENDPT="https://life-skills-dev.appspot.com",e}(),g=function(){function e(){}return e.getFbProfile="https://graph.facebook.com/v2.8/me?fields=first_name,last_name,gender,picture.width(500).height(500),birthday,email&access_token=",e.genJustbeAccessToken=h.API_ENDPT+"/api/justbe/generateJusteBeToken",e}(),m=function(){return function(e,i,t,r,o,n){this.images=new Array,this.emails=new Array,e&&(this.firstName=e),i&&(this.lastName=i),t&&this.images.push(t),r&&this.emails.push(r),o&&(this.id=o),n&&(this.gender=n)}}(),d=function(){function e(){}return e.prototype.getStabilizedProfile=function(e,i){switch(e.loginType){case"facebook":return new m(i.first_name,i.last_name,this.getFbProfileImg(i),i.email,i.id,i.gender);case"google":return new m(i.givenName,i.familyName,i.imageUrl,i.email,i.userId,i.gender)}},e.prototype.getFbProfileImg=function(e){return e.picture&&e.picture.data&&e.picture.data.url?e.picture.data.url:console.log("no image found for fb profile//missing from facebook only")},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[]},e}(),b=function(){function e(e,i,t,r){this._rst=e,this._fb=i,this._ggp=t,this._profileStabilizer=r}return e.prototype.execute=function(e,i,t){switch(this.setLcircular(e,i,t),e.loginType){case"facebook":return this.fbLogin();case"google":return this.ggpLogin()}},e.prototype.get_fbProfile=function(e){var i=this;this.lCircular.params=new s.RestParams,this.lCircular.params.uri=g.getFbProfile+e.authResponse.accessToken,this.getProfile(this.lCircular.params).subscribe(function(e){i.stabilizeProfile(e)})},e.prototype.getProfile=function(e){return this._rst.get(e).map(function(e){return JSON.parse(e._body)},function(e){return e})},e.prototype.setLcircular=function(e,i,t){this.lCircular=new Object,this.lCircular.success=i,this.lCircular.error=t,this.lCircular._circular=e},e.prototype.stabilizeProfile=function(e){var i=this._profileStabilizer.getStabilizedProfile(this.lCircular._circular,e);this.emitOutput(i)},e.prototype.emitOutput=function(e){this.lCircular.success(e)},e.prototype.fbLogin=function(){var e=this;this._fb.login(["public_profile","email"]).then(function(i){e.get_fbProfile(i)},function(i){e.lCircular._circular.error(i)})},e.prototype.ggpLogin=function(){var e=this;this._ggp.login({}).then(function(i){e.stabilizeProfile(i)},function(i){e.lCircular._circular.error(i)})},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:n.RestService},{type:r.Facebook},{type:o.GooglePlus},{type:d}]},e}(),y=function(){return function(e,i){e&&(this.imageUrl=e),this.defaultImage=!!i}}(),_=function(){return function(e,i,t,r,o,n,s){e&&(this.userVerified=e),i&&(this.firstName=i),t&&(this.lastName=t),r&&(this.emails=r),o&&o[0]&&(this._images=new Array,this._images.push(new y(o[0],!0))),n&&(this.dob=n),"male"===s?this.gender=0:"female"===s&&(this.gender=1)}}(),v=function(){function e(e,i){var t=this.getVals(e);this.profileType=t.profileType,this.openProfileId=t.openProfileId,this.profileVO=new _(!1,e.profile.firstName,e.profile.lastName,e.profile.emails,e.profile.images,e.profile.dob,e.profile.gender)}return e.prototype.getVals=function(e){switch(e.loginType){case"facebook":return{profileType:"FacebookProfile",openProfileId:"FacebookProfile#"+e.profile.id};case"google":return{profileType:"Google2Profile",openProfileId:"Google2Profile#"+e.profile.id};default:return{profileType:"",openProfileId:""}}},e}(),P=function(){function e(e,i){this._navParams=e,this._ionicModalHelperSrv=i,console.log(e.data.afterSelectEmail),console.log(e.data.profile),this.profile=e.data.profile}return e.prototype.onSubmitClick=function(e){this.basicValidateEmail(e)?this._navParams.data&&this._navParams.data.afterSelectEmail?(this._navParams.data.afterSelectEmail(e),this._ionicModalHelperSrv.closeModal()):console.error("pass callback function to component, what to do after clicking on submit"):this.validationMsg="Invalid Email"},e.prototype.basicValidateEmail=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},e.decorators=[{type:i.Component,args:[{selector:"email-getter",template:'\n  <ion-header>\n    <ion-title>Enter Email</ion-title>\n  </ion-header>\n<ion-content class="app-bg-color">\n  <ion-grid>\n    <ion-row text-center>\n      <ion-col text-center col-12 class="profilesetting-img">\n        <img [src]="profile.profileVO._images[0].imageUrl">\n        <h1>{{profile.profileVO.firstName}} {{profile.profileVO.lastName}}</h1>\n      </ion-col>\n    </ion-row>\n  </ion-grid>\n  <ion-card padding>\n      <ion-list margin-bottom>\n        <ion-item>\n          <ion-input type="text" placeholder="enter your email" [(ngModel)]="email"></ion-input>\n          <span style="color:red">{{validationMsg}}</span>\n        </ion-item>\n      </ion-list>\n      <button  block ion-button  small item-end icon-left  color="primary" (click)="onSubmitClick(email)">\n        Submit\n      </button>  \n  </ion-card>     \n</ion-content>\n  '}]}],e.ctorParameters=function(){return[{type:l.NavParams},{type:a.IonicModalHelperSrv}]},e}(),S=function(){function e(e,i){this._rst=e,this._ionicModalHelperSrv=i}return e.prototype.execute=function(e,i,t){var r=this;this.setLcircular(e,i,t),this.lCircular.justbeProfile=new v(e,this.lCircular),this.validation(this.lCircular.justbeProfile)?this.getJustbeAccessToken(this.lCircular.params).subscribe(function(e){r.lCircular.success(e)}):this._ionicModalHelperSrv.raiseModal(P,{afterSelectEmail:this.afterEmailSelect.bind(this),profile:this.lCircular.justbeProfile})},e.prototype.setLcircular=function(e,i,t){this.lCircular=new Array,this.lCircular.success=i,this.lCircular.error=t,this.lCircular._circular=e,this.lCircular.params=new s.RestParams,this.lCircular.params.uri=g.genJustbeAccessToken},e.prototype.getJustbeAccessToken=function(e){var i=this;return e.payload=this.lCircular.justbeProfile,this._rst.post(e).map(function(e){return JSON.parse(e._body)},function(e){i.lCircular._circular.error(e)})},e.prototype.validation=function(e){return e.profileVO.emails.length>0},e.prototype.afterEmailSelect=function(e){var i=this;this.lCircular.params.payload=this.lCircular.justbeProfile,this.lCircular.params.payload.profileVO.emails.push(e),this.getJustbeAccessToken(this.lCircular.params).subscribe(function(e){i.lCircular.success(e)})},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:n.RestService},{type:a.IonicModalHelperSrv}]},e}(),C=function(){function e(e,i,t,r){this._ssp=e,this._ysp=i,this._nativeStorage=t,this._ionicToastHelperSrv=r,this.onInit()}return e.prototype.onInit=function(){},e.prototype.login=function(e,i,t){this.setCircular(e,i,t),this._ssp.execute(this.circular,this.onSspSuccess.bind(this),this.onSspError.bind(this))},e.prototype.onSspSuccess=function(e){this.circular.profile=e,this._ysp.execute(this.circular,this.onYspSuccess.bind(this),this.onYspError.bind(this))},e.prototype.onSspError=function(e){this.circular.error(e)},e.prototype.onYspSuccess=function(e){this.circular.success(e),this.raiseToast(),this._nativeStorage.setItem("access_token",e).then(function(){console.info("token stored")},function(e){return console.error("Error storing item",e)})},e.prototype.onYspError=function(e){this.circular.error(e)},e.prototype.setCircular=function(e,i,t){this.circular=new Object,this.circular.loginType=e,this.circular.success=i,this.circular.error=t},e.prototype.raiseToast=function(){var e=new p.Toast;e.message="Login Successful",e.position="bottom",this._ionicToastHelperSrv.raiseToast(e,function(){})},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:b},{type:S},{type:c.NativeStorage},{type:u.IonicToastHelperSrv}]},e}(),k=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{declarations:[P],imports:[l.IonicModule],exports:[P],entryComponents:[P]}]}],e.ctorParameters=function(){return[]},e}(),T=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{imports:[t.CommonModule,f.AngularxRestful,k],providers:[C,r.Facebook,o.GooglePlus,n.RestService,b,S,d,c.NativeStorage]}]}],e.ctorParameters=function(){return[]},e}();e.IonicLogin=T,e.EmailGetterComponent=P,Object.defineProperty(e,"__esModule",{value:!0})});